<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [WebApiBridge][1]
    -   [Examples][2]
    -   [apis][3]
    -   [ipc][4]
    -   [useReactNativeWebView][5]
    -   [listener][6]
    -   [origin][7]
    -   [targetOrigin][8]
    -   [onMessage][9]
        -   [Parameters][10]
    -   [send][11]
        -   [Parameters][12]

## WebApiBridge

`WebApiBridge` is a plain JavaScript class that can be used in a React Native application and
in a web app running in a [react-native-webview][13]
to support a function call API between the two. [React Native WebView][14]
will also still work. It can also be used as an IPC mechanism between other windows, for example,
a web page and an iframe. The intention is for this code to be used in a web app that is using
either a framework or pure JavaScript so framework code was kept out of this class.

WebApiBridge works by passing `Message` objects between Javascript processes.

### Examples

Example React Native API implementation using a `WebApiBridge`.


```javascript
import React from 'react';
import { WebView } from 'react-native-webview';
import WebApiBridge from '@precor/web-api-bridge';

class WebViewApi extends React.Component {
  constructor(props) {
    super(props);
    this.webApiBridge = new WebApiBridge();
    this.onMessage = this.webApiBridge.onMessage.bind(this.webApiBridge);
    this.webApiBridge.apis = [this]; // could be an array of apis passed as a prop instead
    props.send(this.webApiBridge.send.bind(this.webApiBridge));
  }

  set webview(webview) {
    const { onWebViewRef } = this.props;
    this.webApiBridge.ipc = webview;
    if (onWebViewRef) onWebViewRef(webview);
  }

  // incoming call
  myApiCall = (param1, param2) => {
    return new Promise((resolve) => {
      resolve('myApiCall Result');
     });
  }

  // outgoing call
  onPartnerNotify = () => {
    this.send('onPartnerNotify', null, false);
  }

  render() {
    return (
      <WebView
        originWhitelist={['*']}
        javaScriptEnabled
        ref={(webview) => { this.webview = webview; }}
        onMessage={this.onMessage}
        scrollEnabled={false}
        automaticallyAdjustContentInsets={false}
      />
    );
  }
}

export default WebViewApi;
```

Example `window` API implementation using a `WebApiBridge`.


```javascript
import WebApiBridge from '@precor/web-api-bridge';

const iOS = (process.browser && /iPad|iPhone|iPod/.test(navigator.userAgent));
class MyApi
  constructor() {
     webApiBridge = new WebApiBridge();
     webApiBridge.apis = [this];
     // set-up orgins if not in a webview:
     // webApiBridge.origin = 'https://www.mydom.com';
     // webApiBridge.targetOrigin = 'https://www.mydom.com';
     const eventObj = (iOS) ? window : document; // window if not in a webview
     eventObj.addEventListener('message', event => webApiBridge.onMessage(event, event.data));
     // for webview:
     webApiBridge.ipc = window;
     webApiBridge.useReactNativeWebView = true; // webview side only
     // enable this for non-webview:
     // webApiBridge.ipc = window; // use window.parent for an iframe
  }

   // call with myApi.myApiCall(thing1, thing2).then(result => console.log(result));
   myApiCall(param1, param2) {
     webApiBridge.send('myApiCall', [param1, param2], true);
   }

   onPartnerNotify() {
     console.log('other side called onPartnerNotify');
   }
 }

const myApi = new MyApi();

export default myApi;
```

### apis

Property of the api objects that contain methods for incoming api function
calls. This is an array of objects so that a single `WebViewApi` can have
multiple APIs. The last API with a function is used if the function exists
in more than one API.

### ipc

Property for ipc object to post messages to the other side. Typically the `window`,
or a `window.parent` for an iframe in a normal web page. For the `WebView`
component on the React Native side use the `ref`, and for the web side of
[react-native-webview][13]
use `window.parent` for iOS and `window` for Android.

### useReactNativeWebView

Property that should be truthy for a webview using
[react-native-webview][13]. When set
`ipc.ReactNativeWebView.postMessage` will be used instead of `ipc.postMessage`.

### listener

Listener functions can monitor all `Message` objects exchanged
between `WebApiBridge` objects. Listener functions are attached to `WebApiBridge` instances
by setting the `listener` property.

### origin

Property for validating the origin of received messages. The property is set to a substring
of the origin to be matched in browser windows. This makes it easy to provide some checking
in development mode, for example, `':3000'` will allow messages from any server using port
3000\. By default it's set to `''`, which will allow messages from any origin. This field
should be set as restrictrively as possible. e.g. `'https://www.mydomain.com:3000'`. Note
that his property is irrelevant in React Native WebViews.

### targetOrigin

Property for specifying the origin of the target window in messages sent to browser windows.
By default it's set to `'*'`, which will allow messages to any document. This field
should be set as restrictrively as possible. e.g. `'https://www.mydomain.com:3000'`. Note
that his property is irrelevant in React Native WebViews.

### onMessage

Function that should get called when an event containing a message is received
from the other side.

#### Parameters

-   `event` **[object][15]** Incomming event.
-   `data` **[string][16]** The incoming data received, which is a stingified JSON
    message. Defaults to `event.nativeEvent.data`, which is correct for React Native
    but needs to be overridden for the web app with `event.data`. (optional, default `event.nativeEvent.data`)

### send

Invoke a function on the remote.
Returns a `Promise` object.

#### Parameters

-   `targetFunc` **[string][16]** A string of the name of the api function to execute.
-   `args` **[Array][17]** An array of parameters to be passsed to the `targetFun`.
-   `wantResult` **[boolean][18]** Boolean to indicate if a `Promise` should be `fullfilled`
       or `rejected` after the remote api completes the call. If `false` then no `Promise`
       will be `fullfilled`. (optional, default `false`)

Returns **[Promise][19]** Promise object if `wantResult` is `true`, `null` if not.

[1]: #webapibridge

[2]: #examples

[3]: #apis

[4]: #ipc

[5]: #usereactnativewebview

[6]: #listener

[7]: #origin

[8]: #targetorigin

[9]: #onmessage

[10]: #parameters

[11]: #send

[12]: #parameters-1

[13]: https://github.com/react-native-community/react-native-webview

[14]: https://facebook.github.io/react-native/docs/webview.html

[15]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[16]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[17]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[18]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[19]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise
